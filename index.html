<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title id="metaTitle">  |     </title>
<meta name="description" content="  -           " id="metaDescription">
<meta name="keywords" content=" , , , , " id="metaKeywords">
<style>
@import url('https://fonts.googleapis.com/css2?family=Tajawal:wght@500;700&display=swap');
* { margin: 0; padding: 0; box-sizing: border-box; }
body {
  font-family: 'Tajawal', sans-serif;
  color: white;
  text-align: center;
  overflow-x: hidden;
  background: #000;
  transition: background 0.5s, color 0.5s;
}
body.dark-mode { background: #111; color: #ddd; }
body::before {
  content: "";
  position: fixed;
  top: 0; left: 0;
  width: 100%; height: 100%;
  background: url("https://i.ibb.co/sdLNWYv5/IMG-20251023-130121-177.jpg") center/cover no-repeat;
  filter: brightness(0.4);
  z-index: -1;
  transition: filter 0.5s;
}
body.dark-mode::before { filter: brightness(0.15); }

.content { display: none; margin-top: 20px; padding-bottom: 50px; }
.content.active { display: block; }

h1 { font-size: 1.8em; margin-top: 10px; text-shadow: 0 0 8px #ff0000; }
h2 { font-size: 1.2em; margin-top: 10px; text-shadow: 0 0 6px #ff0000; }
p { font-size: 1em; color: #ddd; margin: 5px 0 15px 0; }

.logo { width: 100px; border-radius: 50%; box-shadow: 0 0 12px #ff0000; margin-top: 20px; }

a, button {
  display: block;
  background-color: rgba(15,15,15,0.8);
  color: #fff;
  text-decoration: none;
  margin: 6px auto;
  padding: 10px;
  border-radius: 12px;
  width: 220px;
  font-weight: bold;
  border: 1px solid red;
  box-shadow: 0 0 10px red;
  transition: 0.3s;
  font-size: 0.95em;
  cursor: pointer;
}
a:hover, button:hover { transform: scale(1.05); box-shadow: 0 0 25px #ff0000; }

.menu-btn { 
  position: fixed; 
  top: 15px; 
  left: 15px;
  font-size: 18px; 
  background: rgba(255,255,255,0.15); 
  padding: 5px 10px; 
  border-radius: 8px; 
  cursor: pointer; 
  z-index: 1002; 
  border: 1px solid red; 
  transition: 0.3s;
}
.menu-btn:hover { background: rgba(255,0,0,0.5); }


.sidebar {
  width: 240px;
  height: 100%;
  background: rgba(10,10,10,0.95);
  backdrop-filter: blur(5px);
  position: fixed;
  top: 0;
  left: -240px; 
  transition: 0.4s;
  padding-top: 70px;
  z-index: 1001;
  border-right: 2px solid #ff0000;
  box-shadow: 0 0 15px rgba(255,0,0,0.4);
}
.sidebar a, .sidebar button {
  width: 85%;
  margin: 10px auto;
  background: rgba(20,20,20,0.8);
  border: 1px solid #ff0000;
  border-radius: 10px;
  box-shadow: 0 0 8px #ff0000;
}

#cryptoPrices table {
    width: 90%;
    margin: 20px auto;
    border-collapse: collapse;
    color: #fff;
    font-size: 0.85em;
    direction: ltr; 
}
#cryptoPrices th, #cryptoPrices td {
    padding: 10px;
    border-bottom: 1px solid rgba(255,0,0,0.3);
}
#cryptoPrices th {
    background-color: rgba(255,0,0,0.2);
    color: #ff0000;
}
#cryptoPrices td {
    text-align: left;
}
#cryptoPrices .price {
    font-weight: bold;
    color: #00ff00; 
}
#cryptoPrices .name {
    color: #fff;
    font-weight: 500;
}


.crypto-calc-btn-in-section {
    display: block; 
    width: 80%; 
    max-width: 300px; 
    margin: 15px auto; 
    padding: 12px;
    font-size: 1.1em;
    background-color: rgba(255, 0, 0, 0.7); 
    border-color: #fff;
    box-shadow: 0 0 15px #ff0000;
}


.popup-overlay {
  position: fixed;
  top: 0; left: 0;
  width: 100%; height: 100%;
  background: rgba(0,0,0,0.7);
  display: none;
  justify-content: center;
  align-items: center;
  z-index: 2000;
  animation: fadeIn 0.4s;
}
.popup-box {
  background: rgba(20,20,20,0.95);
  border: 2px solid #ff0000;
  border-radius: 15px;
  padding: 20px;
  width: 85%;
  max-width: 400px;
  box-shadow: 0 0 20px rgba(255,0,0,0.5);
  text-align: center;
  animation: fadeInUp 0.4s;
}
.popup-box h3 {
  color: #ff0000;
  margin-bottom: 10px;
}
.popup-box p {
  color: #ddd;
  font-size: 1em;
  line-height: 1.6em;
}
.close-btn {
  background: #ff0000;
  color: #fff;
  border: none;
  padding: 8px 20px;
  border-radius: 10px;
  margin-top: 15px;
  cursor: pointer;
  font-weight: bold;
  transition: 0.3s;
}
.close-btn:hover {
  background: #cc0000;
  transform: scale(1.05);
}
@keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }
@keyframes fadeInUp { from { transform: translateY(30px); opacity: 0; } to { transform: translateY(0); opacity: 1; } }

.snowflake { position: fixed; top: -10px; background: white; border-radius: 50%; opacity: 0.8; pointer-events: none; z-index: 1000; animation-name: fall; animation-timing-function: linear; }
@keyframes fall { 0% { transform: translateY(0); opacity: 1; } 100% { transform: translateY(110vh); opacity: 0.5; } }
.language-buttons { display: none; margin-top: 5px; flex-direction: column; }
.language-buttons button { width: 80%; margin: 4px auto; }

.fixed-buttons a, .fixed-buttons button {
  width: 220px;
  font-size: 0.95em;
  box-shadow: 0 0 8px red;
}



#crypto-calc-popup .popup-box {
  max-width: 340px;
  padding: 15px;
}
.calc-controls {
  display: flex;
  justify-content: space-between;
  align-items: center;
  margin-bottom: 15px;
  direction: ltr; 
}
.calc-controls input {
  width: 45%;
  padding: 8px;
  border-radius: 8px;
  border: 1px solid #ff0000;
  background: rgba(10,10,10,0.8);
  color: #fff;
  text-align: center;
  font-size: 1.1em;
}


#coin-select-btn {
  width: 50%;
  padding: 8px;
  border-radius: 8px;
  border: 1px solid #ff0000;
  background: rgba(10,10,10,0.8);
  color: #fff;
  font-size: 1.0em;
  cursor: pointer;
  margin: 0; 
  transition: none;
}
#coin-select-btn:hover {
    transform: none;
    box-shadow: 0 0 10px red;
}


#coin-buttons-container {
    display: flex;
    flex-wrap: wrap;
    justify-content: center;
    max-height: 150px;
    overflow-y: auto;
    padding: 5px;
    margin-top: 10px;
    border: 1px solid rgba(255,0,0,0.3);
    border-radius: 10px;
}


.coin-select-button {
    background-color: rgba(30, 30, 30, 0.9);
    color: #fff;
    border: 1px solid #ff4444;
    border-radius: 6px;
    padding: 5px 10px;
    margin: 4px;
    width: auto; 
    font-size: 0.85em;
    cursor: pointer;
    box-shadow: none;
    transition: 0.2s;
}
.coin-select-button.selected {
    background-color: #ff0000;
    border-color: #fff;
    box-shadow: 0 0 10px #ff0000;
}


#calc-result {
  min-height: 40px;
  background: rgba(50,50,50,0.6);
  border: 1px solid #00ff00;
  border-radius: 10px;
  padding: 10px;
  color: #00ff00;
  font-weight: bold;
  font-size: 1.1em;
  margin-top: 15px;
}


#calculator {
  max-width: 280px; 
  margin: 30px auto;
  padding: 15px;
  background: rgba(10,10,10,0.95);
  border-radius: 15px;
  border: 2px solid #ff0000;
  box-shadow: 0 0 20px rgba(255,0,0,0.4);
}

.calc-display {
  background: rgba(0,0,0,0.6);
  border: 1px solid #ff0000;
  border-radius: 10px;
  color: #fff;
  text-align: right;
  padding: 10px; 
  font-size: 1.8em; 
  min-height: 60px; 
  margin-bottom: 10px; 
  overflow-x: auto;
  direction: ltr;
  font-weight: bold;
}

.calc-keys {
  display: grid;
  grid-template-columns: repeat(4, 1fr);
  gap: 8px; 
}

.calc-key {
  width: 100%;
  height: 50px; 
  border-radius: 50%;
  font-size: 1.2em; 
  font-weight: bold;
  cursor: pointer;
  transition: 0.2s;
  border: none;
}


.calc-key.number, .calc-key.special {
  background-color: rgba(255, 255, 255, 0.1); 
  color: #fff;
  border: 1px solid rgba(255,0,0,0.3);
}


.calc-key.clear, .calc-key.parenthesis, .calc-key.percent {
  background-color: rgba(180, 180, 180, 0.2); 
  color: #fff;
  border: 1px solid #ff0000;
}
.calc-key.clear {
  background-color: rgba(255, 0, 0, 0.3); 
}


.calc-key.operator {
  background-color: #ff0000; 
  color: #fff;
  border: 1px solid #fff;
}


.calc-key.equal {
  background-color: #00cc00; 
  color: #fff;
  grid-column: span 1;
}

.calc-key:active {
  transform: scale(0.95);
}

.calc-key.number:active, .calc-key.special:active {
  background-color: rgba(255, 255, 255, 0.3);
}

.calc-key.operator:active {
  background-color: #cc0000;
}

.calc-key.equal:active {
  background-color: #00aa00;
}

.calc-key.zero {
  grid-column: span 1; 
  border-radius: 50%; 
}

</style>
</head>
<body>

<audio id="clickSound" src="https://files.catbox.moe/opzbli.mp3"></audio>

<div class="menu-btn" onclick="toggleMenu()"></div>

<div class="sidebar" id="sidebar">
  <a href="#" id="usageBtn" onclick="playSound(); openUsagePopup()">•   •</a>
  <a href="#" id="brokerQstBtn" onclick="playSound(); openPopup()">•    •</a>
  <a href="#" id="cryptoBtn" onclick="playSound(); show('cryptoPrices'); fetchCryptoPrices(false, true); toggleMenu()">•    •</a>
  <a href="#" id="calcBtn" onclick="playSound(); show('calculatorPage'); toggleMenu()">•   •</a>
  <button id="darkModeBtn" onclick="toggleDarkModeFunc(); playSound()">•   •</button>
  <button id="langToggleBtn" onclick="toggleLangBtns(); playSound()">•  •</button>
  <div class="language-buttons" id="langBtns">
    <button onclick="setLang('ar'); playSound()"></button>
    <button onclick="setLang('en'); playSound()">English</button>
  </div>
</div>

<div class="popup-overlay" id="crypto-calc-popup">
  <div class="popup-box">
    <h3 id="calcTitle">  </h3>
    
    <div class="calc-controls" dir="ltr">
        <input type="number" id="crypto-amount" value="1" min="0.01" step="any" oninput="calculateCryptoValue()">
        <button id="coin-select-btn" onclick="toggleCoinButtons(); playSound()"> </button>
    </div>
    
    <div id="coin-buttons-container" style="display: none;">
        </div>
    
    <div id="calc-result">: 0.00 USD</div>
    
    <button class="close-btn" onclick="closeCryptoCalcPopup(); playSound()"></button>
  </div>
</div>

<div class="popup-overlay" id="popup">
  <div class="popup-box">
    <h3 id="brokerPopupTitle">•    •</h3>
    <p id="brokerPopupText">
                 .<br>
                .<br>
                .
    </p>
    <button class="close-btn" id="brokerCloseBtn" onclick="closePopup(); playSound()"></button>
  </div>
</div>

<div class="popup-overlay" id="usagePopup">
  <div class="popup-box">
    <h3 id="usagePopupTitle">•   •</h3>
    <p id="usagePopupText">
             ...<br>
          <br>
        .
    </p>
    <button class="close-btn" id="usageCloseBtn" onclick="closeUsagePopup(); playSound()"></button>
  </div>
</div>

<div class="wrapper">
  <section class="content active" id="main">
    <img src="https://i.ibb.co/sdLNWYv5/IMG-20251023-130121-177.jpg" class="logo">
    <h1 id="mainTitle">  - Super Zwn</h1>
    <p id="mainDesc">     <br>    </p>

    <div class="fixed-buttons">
      <a id="channelBtn" href="https://t.me/superrzwn" target="_blank" onclick="playSound()">•    •</a>
      <a id="groupBtn" href="https://t.me/+yvlUKvFLZEFkNDU0" target="_blank" onclick="playSound()">•    •</a>
      <button id="brokersBtn" onclick="playSound(); show('brokers')">•   •</button>
      
      <button id="tonBtn" class="spaced" onclick="playSound()"> TON:  ...</button>
      
      <button id="timeBtn" class="spaced" onclick="playSound()">  ...</button>
      <button id="dateBtn" onclick="playSound()">  ...</button>
    </div>
  </section>

  <section class="content" id="brokers">
    <img src="https://i.ibb.co/sdLNWYv5/IMG-20251023-130121-177.jpg" class="logo">
    <h1 id="brokersTitle">  - Super Zwn</h1>
    <h2 id="brokersDesc"> </h2>
    <div id="brokersList">
      <a class="btn" href="https://t.me/vwvvxv" target="_blank" onclick="playSound()">•   •</a>
      <a class="btn" href="https://t.me/vrwvw" target="_blank" onclick="playSound()">•   •</a>
      <a class="btn" href="https://t.me/GreaTeeid" target="_blank" onclick="playSound()">•   •</a>
      <a class="btn" href="https://t.me/x_o_z" target="_blank" onclick="playSound()">•   •</a>
      <a class="btn" href="https://t.me/j_e_o" target="_blank" onclick="playSound()">•   •</a>
      <a class="btn" href="https://t.me/mrtrgm" target="_blank" onclick="playSound()">•   •</a>
      <a class="btn" href="https://t.me/ahmedrio" target="_blank" onclick="playSound()">•   •</a>
    </div>
    <button class="btn" id="brokersBackBtn" onclick="playSound(); show('main')">•    •</button>
  </section>
  
  <section class="content" id="cryptoPrices">
    <img src="https://i.ibb.co/sdLNWYv5/IMG-20251023-130121-177.jpg" class="logo">
    <button class="crypto-calc-btn-in-section" id="cryptoCalcBtnInSec" onclick="openCryptoCalcPopup(); playSound()">  </button>
    <h1 id="cryptoTitle">  - Super Zwn</h1>
    <h2 id="cryptoDesc"> 15  </h2>
    <div id="cryptoList">
      <p id="cryptoStatus">  ...</p>
    </div>
    <button class="btn" id="cryptoBackBtn" onclick="playSound(); show('main')">•    •</button>
    <button class="btn" id="cryptoRefreshBtn" onclick="playSound(); fetchCryptoPrices(true, true)">  </button>
  </section>

  <section class="content" id="calculatorPage">
    <img src="https://i.ibb.co/sdLNWYv5/IMG-20251023-130121-177.jpg" class="logo">
    <h1 id="calcPageTitle">  - Super Zwn</h1>
    <h2 id="calcPageDesc"> </h2>
     <div id="calculator">
      <div class="calc-display" id="display">0</div>
      <div class="calc-keys">
        <button class="calc-key clear" data-action="clear" id="key-C">C</button>
        <button class="calc-key parenthesis" data-action="parenthesis" id="key-paren">()</button>
        <button class="calc-key percent" data-action="percent" id="key-percent">%</button>
        <button class="calc-key operator" data-action="divide" id="key-divide">÷</button>

        <button class="calc-key number" data-value="7" id="key-7">7</button>
        <button class="calc-key number" data-value="8" id="key-8">8</button>
        <button class="calc-key number" data-value="9" id="key-9">9</button>
        <button class="calc-key operator" data-action="multiply" id="key-multiply">×</button>

        <button class="calc-key number" data-value="4" id="key-4">4</button>
        <button class="calc-key number" data-value="5" id="key-5">5</button>
        <button class="calc-key number" data-value="6" id="key-6">6</button>
        <button class="calc-key operator" data-action="subtract" id="key-subtract">-</button>

        <button class="calc-key number" data-value="1" id="key-1">1</button>
        <button class="calc-key number" data-value="2" id="key-2">2</button>
        <button class="calc-key number" data-value="3" id="key-3">3</button>
        <button class="calc-key operator" data-action="add" id="key-add">+</button>

        <button class="calc-key special" data-action="sign" id="key-sign">+/-</button>
        <button class="calc-key number" data-value="0" id="key-0">0</button>
        <button class="calc-key special" data-action="decimal" id="key-decimal">.</button>
        <button class="calc-key equal" data-action="calculate" id="key-equal">=</button>
      </div>
    </div>
    <button class="btn" id="calcBackBtn" onclick="playSound(); show('main')">•    •</button>
  </section>
</div>

<script>
const LANG_DATA = {
    'ar': {
        meta: {
            title: "  |     ",
            description: "  -           ",
            keywords: " , , , , ",
        },
        sidebar: {
            usageBtn: "•   •",
            brokerQstBtn: "•    •",
            cryptoBtn: "•    •",
            calcBtn: "•   •",
            darkModeBtn: ["•   •", "•   •"],
            langToggleBtn: "•  •",
        },
        main: {
            mainTitle: "  - Super Zwn",
            mainDesc: "     <br>    ",
            channelBtn: "•    •",
            groupBtn: "•    •",
            brokersBtn: "•   •",
            tonLoading: " ...",
            timeLoading: " ...",
            dateLoading: " ...",
        },
        brokers: {
            brokersTitle: "  - Super Zwn",
            brokersDesc: " ",
            brokersBackBtn: "•    •",
            list: [
                "•   •", "•   •", "•   •", "•   •",
                "•   •", "•   •", "•   •"
            ]
        },
        crypto: {
            cryptoCalcBtnInSec: "  ",
            cryptoTitle: "  - Super Zwn",
            cryptoDesc: " 15  ",
            cryptoStatusLoading: "  ...",
            cryptoStatusError: "    .",
            cryptoBackBtn: "•    •",
            cryptoRefreshBtn: "  ",
            tableHeaders: ["#", "", " (USD)"],
        },
        calculator: {
            calcPageTitle: "  - Super Zwn",
            calcPageDesc: " ",
            calcBackBtn: "•    •",
            keys: {
                'key-C': 'C', 'key-paren': '()', 'key-percent': '%', 'key-divide': '÷',
                'key-7': '7', 'key-8': '8', 'key-9': '9', 'key-multiply': '×',
                'key-4': '4', 'key-5': '5', 'key-6': '6', 'key-subtract': '-',
                'key-1': '1', 'key-2': '2', 'key-3': '3', 'key-add': '+',
                'key-sign': '+/-', 'key-0': '0', 'key-decimal': '.', 'key-equal': '=',
            },
        },
        brokerPopup: {
            title: "•    •",
            text: "           .<br>          .<br>          .",
            closeBtn: "",
        },
        usagePopup: {
            title: "•   •",
            text: "             ...<br>          <br>        .",
            closeBtn: "",
        },
        calc: {
            calcTitle: "  ",
            selectCoinBtn: " ",
            loadingCoins: "  ...",
            resultDefault: ": 0.00 USD",
            inputError: "     .",
            closeBtn: "",
        },
        other: {
            tonError: "",
            cryptoNA: " ",
        }
    },
    'en': {
        meta: {
            title: "Super Zwn | Biggest Arabic Super on Telegram",
            description: "Super Zwn - The first Arabic Super on Telegram  Biggest sales and highest trust",
            keywords: "Super Zwn, Telegram, Brokers, Sales, Arabic",
        },
        sidebar: {
            usageBtn: "• Meaning of Super •",
            brokerQstBtn: "• What is a Broker •",
            cryptoBtn: "• Crypto Prices •",
            calcBtn: "• Calculator •",
            darkModeBtn: ["• Dark Mode •", "• Light Mode •"],
            langToggleBtn: "• Language •",
        },
        main: {
            mainTitle: "Super Zwn - Super Zwn",
            mainDesc: "The first Arabic Super on Telegram <br>Biggest sales and highest trust",
            channelBtn: "• Super Zwn Channel •",
            groupBtn: "• Super Zwn Group •",
            brokersBtn: "• Super Brokers •",
            tonLoading: "Loading...",
            timeLoading: "Updating...",
            dateLoading: "Updating...",
        },
        brokers: {
            brokersTitle: "Super Zwn - Super Zwn",
            brokersDesc: "Authorized Brokers",
            list: [
                "• Broker Timo •", "• Broker Hamo •", "• Broker Eid •", "• Broker Salk •",
                "• Broker Yousef •", "• Broker Error •", "• Broker Rio •"
            ],
            brokersBackBtn: "• Back to Main Menu •",

        },
        crypto: {
            cryptoCalcBtnInSec: "Calculate Coin Price",
            cryptoTitle: "Super Zwn - Super Zwn",
            cryptoDesc: "Top 15 Cryptocurrencies",
            cryptoStatusLoading: "Loading Prices...",
            cryptoStatusError: "Failed to fetch prices, try later.",
            cryptoBackBtn: "• Back to Main Menu •",
            cryptoRefreshBtn: " Refresh Prices",
            tableHeaders: ["#", "Coin", "Price (USD)"],
        },
        calculator: {
            calcPageTitle: "Super Zwn - Super Zwn",
            calcPageDesc: "Calculator",
            calcBackBtn: "• Back to Main Menu •",
            keys: {
                'key-C': 'C', 'key-paren': '()', 'key-percent': '%', 'key-divide': '÷',
                'key-7': '7', 'key-8': '8', 'key-9': '9', 'key-multiply': '×',
                'key-4': '4', 'key-5': '5', 'key-6': '6', 'key-subtract': '-',
                'key-1': '1', 'key-2': '2', 'key-3': '3', 'key-add': '+',
                'key-sign': '+/-', 'key-0': '0', 'key-decimal': '.', 'key-equal': '=',
            },
        },
        brokerPopup: {
            title: "• What is a Broker •",
            text: "A broker is a trusted person who facilitates deals between two parties to ensure everyone's rights.<br>Their task is to ensure the transaction's security and follow every step until the deal is completed.<br>Dealing without a broker may lead to loss of rights or misunderstanding.",
            closeBtn: "Close",
        },
        usagePopup: {
            title: "• Meaning of Super •",
            text: "Super Zwn is a store for buying and selling groups, channels, stars, gifts, and more...<br>We facilitate fast sales for users to sell their possessions quickly<br>Dealing in the Super is with a broker to ensure the rights of both parties.",
            closeBtn: "Close",
        },
        calc: {
            calcTitle: "Crypto Calculator",
            selectCoinBtn: "Select Coin",
            loadingCoins: "Loading coins...",
            resultDefault: "Result: 0.00 USD",
            inputError: "Please enter a valid amount and select a coin.",
            closeBtn: "Close",
        },
        other: {
            tonError: "Error",
            cryptoNA: "N/A",
        }
    }
};

const BINANCE_TOP_SYMBOLS = [
    'BTCUSDT', 'ETHUSDT', 'BNBUSDT', 'SOLUSDT', 'XRPUSDT', 
    'DOGEUSDT', 'ADAUSDT', 'AVAXUSDT', 'TRXUSDT', 'DOTUSDT',
    'LINKUSDT', 'TONUSDT', 'MATICUSDT', 'SHIBUSDT', 'BCHUSDT'
];
const symbolToNameMap = {
    'BTCUSDT': 'Bitcoin', 'ETHUSDT': 'Ethereum', 'BNBUSDT': 'BNB', 
    'SOLUSDT': 'Solana', 'XRPUSDT': 'Ripple', 'DOGEUSDT': 'Dogecoin', 
    'ADAUSDT': 'Cardano', 'AVAXUSDT': 'Avalanche', 'TRXUSDT': 'TRON', 
    'DOTUSDT': 'Polkadot', 'LINKUSDT': 'Chainlink', 'TONUSDT': 'TON Coin', 
    'MATICUSDT': 'Polygon', 'SHIBUSDT': 'Shiba Inu', 'BCHUSDT': 'Bitcoin Cash'
};


let currentLang = 'ar'; 
let cryptoPricesData = []; 
let selectedCoin = null; 
let displayValue = '0';
let currentExpression = '';
let parenthesisCount = 0;


function toggleMenu() {
  const s = document.getElementById("sidebar");
  s.style.left = (s.style.left === "0px") ? "-240px" : "0px";
}

function playSound() {
  const audio = document.getElementById("clickSound");
  audio.currentTime = 0;
  audio.play();
}

function openPopup() {
  document.getElementById('popup').style.display = 'flex';
}

function closePopup() {
  document.getElementById('popup').style.display = 'none';
}

function openUsagePopup() {
  document.getElementById('usagePopup').style.display = 'flex';
}

function closeUsagePopup() {
  document.getElementById('usagePopup').style.display = 'none';
}


function openCryptoCalcPopup() {
  document.getElementById('crypto-calc-popup').style.display = 'flex';

  populateCoinButtons(); 
  
  if (!selectedCoin && cryptoPricesData.length > 0) {
      selectCoin(cryptoPricesData[0]);
  } else {
      updateCoinSelectButton();
      calculateCryptoValue(); 
  }
}

function closeCryptoCalcPopup() {
  document.getElementById('crypto-calc-popup').style.display = 'none';
}

function toggleCoinButtons() {
    const container = document.getElementById('coin-buttons-container');
    container.style.display = (container.style.display === 'flex') ? 'none' : 'flex';
}

function populateCoinButtons() {
    const container = document.getElementById('coin-buttons-container');
    container.innerHTML = ''; 
    const lang = LANG_DATA[currentLang];

    if (cryptoPricesData.length === 0) {
        container.innerHTML = `<button class="coin-select-button" style="width: 90%; background: #cc0000; cursor: default;">${lang.calc.loadingCoins}</button>`;

        fetchCryptoPrices(true, true); 
        return; 
    }

    cryptoPricesData.forEach(coin => {
        let button = document.createElement('button');
        button.classList.add('coin-select-button');
        const coinSymbol = coin.symbol.toUpperCase().replace('USDT', '');
        const coinName = symbolToNameMap[coin.symbol.toUpperCase()] || coinSymbol;

        button.innerText = `${coinName} (${coinSymbol})`;
        if (selectedCoin && selectedCoin.symbol === coin.symbol) {
            button.classList.add('selected');
        }
        
        button.onclick = function() {
            selectCoin(coin);
            toggleCoinButtons(); 
            playSound();
        };
        container.appendChild(button);
    });
}

function selectCoin(coin) {
    selectedCoin = {
        symbol: coin.symbol.toUpperCase(),
        name: symbolToNameMap[coin.symbol.toUpperCase()] || coin.symbol.replace('USDT', ''),
        price: coin.price
    };
    updateCoinSelectButton();
    calculateCryptoValue();
    
    document.querySelectorAll('.coin-select-button').forEach(btn => btn.classList.remove('selected'));
    document.querySelectorAll('.coin-select-button').forEach(btn => {
        if (btn.innerText.includes(selectedCoin.symbol.replace('USDT', ''))) {
            btn.classList.add('selected');
        }
    });
}

function updateCoinSelectButton() {
    const button = document.getElementById('coin-select-btn');
    const lang = LANG_DATA[currentLang];

    if (selectedCoin) {
        button.innerText = `${selectedCoin.name} (${selectedCoin.symbol.replace('USDT', '')})`;
    } else {
        button.innerText = lang.calc.selectCoinBtn;
    }
}


function calculateCryptoValue() {
    const amountInput = document.getElementById('crypto-amount');
    const resultDiv = document.getElementById('calc-result');
    const lang = LANG_DATA[currentLang];

    const amount = parseFloat(amountInput.value);

    if (isNaN(amount) || amount <= 0 || !selectedCoin || isNaN(selectedCoin.price) || selectedCoin.price <= 0) {
        resultDiv.innerText = lang.calc.inputError;
        return;
    }

    const price = selectedCoin.price;
    const totalValue = amount * price;

    const formattedResult = totalValue.toLocaleString('en-US', { 
        style: 'currency', 
        currency: 'USD', 
        minimumFractionDigits: 2,
        maximumFractionDigits: totalValue < 1 ? 6 : 2 
    });
    
    resultDiv.innerText = `${amount} ${selectedCoin.symbol.replace('USDT', '')}  ${formattedResult}`;
}

function show(id){
  document.querySelectorAll('.content').forEach(sec => sec.classList.remove('active'));
  const target = document.getElementById(id);
  if(target) target.classList.add('active');
}

function toggleDarkModeFunc() {
  const body = document.body;
  const btn = document.getElementById('darkModeBtn');
  
  // 1. 
  body.classList.toggle('dark-mode');
  
  const isDarkMode = body.classList.contains('dark-mode');
  const lang = LANG_DATA[currentLang];
  
  // 2. 
  btn.innerHTML = isDarkMode ? lang.sidebar.darkModeBtn[1] : lang.sidebar.darkModeBtn[0];
  
  // 3. 
  if (isDarkMode) {
      localStorage.setItem('theme', 'dark');
  } else {
      localStorage.setItem('theme', 'light');
  }
}


function toggleLangBtns() {
  const div = document.getElementById('langBtns');
  div.style.display = (div.style.display === 'flex') ? 'none' : 'flex';
}

function setLang(lang) {
  currentLang = lang; 

  const data = LANG_DATA[lang];
  const body = document.body;
  const isDarkMode = body.classList.contains('dark-mode');

  // 1. 
  document.documentElement.setAttribute('lang', lang);
  document.documentElement.setAttribute('dir', lang === 'ar' ? 'rtl' : 'ltr');
  document.querySelector('#cryptoPrices table') ? document.querySelector('#cryptoPrices table').setAttribute('dir', 'ltr') : null;
  document.querySelector('.calc-controls') ? document.querySelector('.calc-controls').setAttribute('dir', 'ltr') : null;
  document.getElementById('display').style.direction = 'ltr';


  // 2. 
  document.getElementById('metaTitle').innerText = data.meta.title;
  document.getElementById('metaDescription').setAttribute('content', data.meta.description);
  document.getElementById('metaKeywords').setAttribute('content', data.meta.keywords);

  // 3. 
  document.getElementById('usageBtn').innerText = data.sidebar.usageBtn;
  document.getElementById('brokerQstBtn').innerText = data.sidebar.brokerQstBtn;
  document.getElementById('cryptoBtn').innerText = data.sidebar.cryptoBtn;
  document.getElementById('calcBtn').innerText = data.sidebar.calcBtn; 
  document.getElementById('langToggleBtn').innerText = data.sidebar.langToggleBtn;
  document.getElementById('darkModeBtn').innerHTML = isDarkMode ? data.sidebar.darkModeBtn[1] : data.sidebar.darkModeBtn[0];

  // 4. 
  document.getElementById('mainTitle').innerText = data.main.mainTitle;
  document.getElementById('mainDesc').innerHTML = data.main.mainDesc;
  document.getElementById('channelBtn').innerText = data.main.channelBtn;
  document.getElementById('groupBtn').innerText = data.main.groupBtn;
  document.getElementById('brokersBtn').innerText = data.main.brokersBtn;
  document.getElementById("tonBtn").textContent = ` TON: ${data.main.tonLoading}`;
  document.getElementById("timeBtn").textContent = ` ${data.main.timeLoading}`;
  document.getElementById("dateBtn").textContent = ` ${data.main.dateLoading}`;

  // 5. 
  document.getElementById('brokersTitle').innerText = data.brokers.brokersTitle;
  document.getElementById('brokersDesc').innerText = data.brokers.brokersDesc;
  document.getElementById('brokersBackBtn').innerText = data.brokers.brokersBackBtn;
  const brokersLinks = ['https://t.me/vwvvxv','https://t.me/vrwvw','https://t.me/GreaTeeid','https://t.me/x_o_z','https://t.me/j_e_o','https://t.me/mrtrgm','https://t.me/ahmedrio'];
  const brokersList = document.getElementById('brokersList');
  brokersList.innerHTML = '';
  for(let i=0;i<data.brokers.list.length;i++){
    let a = document.createElement('a');
    a.className = 'btn';
    a.href = brokersLinks[i];
    a.target = '_blank';
    a.innerText = data.brokers.list[i];
    a.onclick = playSound;
    brokersList.appendChild(a);
  }

  // 6. 
  document.getElementById('cryptoCalcBtnInSec').innerText = data.crypto.cryptoCalcBtnInSec;
  document.getElementById('cryptoTitle').innerText = data.crypto.cryptoTitle;
  document.getElementById('cryptoDesc').innerText = data.crypto.cryptoDesc;
  document.getElementById('cryptoBackBtn').innerText = data.crypto.cryptoBackBtn;
  document.getElementById('cryptoRefreshBtn').innerText = data.crypto.cryptoRefreshBtn;
  const cryptoStatusElement = document.getElementById('cryptoStatus');
  if (cryptoStatusElement) {
    cryptoStatusElement.innerText = data.crypto.cryptoStatusLoading; 
  }

  // 7. 
  document.getElementById('calcPageTitle').innerText = data.calculator.calcPageTitle;
  document.getElementById('calcPageDesc').innerText = data.calculator.calcPageDesc;
  document.getElementById('calcBackBtn').innerText = data.calculator.calcBackBtn;
  
  // 
  const keysToUse = data.calculator.keys;
  for (const keyId in keysToUse) {
      const keyElement = document.getElementById(keyId);
      if (keyElement) {
          keyElement.innerText = keysToUse[keyId];
      }
  }


  // 8. 
  document.getElementById('brokerPopupTitle').innerText = data.brokerPopup.title;
  document.getElementById('brokerPopupText').innerHTML = data.brokerPopup.text;
  document.getElementById('brokerCloseBtn').innerText = data.brokerPopup.closeBtn;
  
  document.getElementById('usagePopupTitle').innerText = data.usagePopup.title;
  document.getElementById('usagePopupText').innerHTML = data.usagePopup.text;
  document.getElementById('usageCloseBtn').innerText = data.usagePopup.closeBtn;

  // 9. 
  document.getElementById('calcTitle').innerText = data.calc.calcTitle;
  document.getElementById('coin-select-btn').innerText = selectedCoin ? `${selectedCoin.name} (${selectedCoin.symbol.replace('USDT', '')})` : data.calc.selectCoinBtn;
  document.querySelector('#crypto-calc-popup .close-btn').innerText = data.calc.closeBtn;
  document.getElementById('calc-result').innerText = document.getElementById('crypto-amount').value === '1' && !selectedCoin ? data.calc.resultDefault : document.getElementById('calc-result').innerText;

  // 10. 
  localStorage.setItem('language', lang);


  // 11. 
  updateTime(true); 
  updateDate(true); 
  updateTonPriceInMainSection();
  calculateCryptoValue();
  if(document.querySelector('#cryptoList table')) fetchCryptoPrices(false, false); 
  updateDisplay(); 
}

function updateTime(forceUpdateLabel = false) {
  const now = new Date();
  
  // Format to 12-hour time with AM/PM
  const hours12 = now.toLocaleString('en-US', { hour: 'numeric', hour12: true });
  const minutes = String(now.getMinutes()).padStart(2, '0');
  const seconds = String(now.getSeconds()).padStart(2, '0');
  
  // hours12 returns '9 PM', so we need to extract hour and AM/PM
  const parts = hours12.split(' ');
  const hour = parts[0].replace(/:[0-9]{2}$/, ''); // Get only the hour part (e.g., '9' from '9:30')
  const ampm = parts[1]; // Get AM or PM
  
  const timeText = `${hour}:${minutes}:${seconds} ${ampm}`; 
  
  const timeBtn = document.getElementById("timeBtn");
  
  timeBtn.textContent = " " + timeText;
}

setInterval(updateTime, 1000); 

function updateDate(forceUpdateLabel = false) {
  const today = new Date();
  const lang = currentLang === 'ar' ? 'ar-EG' : 'en-US';

  const dateText = today.toLocaleDateString(lang, { year: 'numeric', month: 'long', day: 'numeric' });
  
  const dateBtn = document.getElementById("dateBtn");
  
  dateBtn.textContent = " " + dateText;
}


async function updateTonPriceInMainSection() {
    const symbol = 'TONUSDT';
    const btn = document.getElementById("tonBtn");
    const lang = LANG_DATA[currentLang];
    
    const loadingText = lang.main.tonLoading;
    const errorText = lang.other.tonError;
    const icon = ' TON';

    if (!btn.textContent.includes('...')) {
        btn.textContent = `${icon}: ${loadingText}`;
    }

    try {
        const res = await fetch(`https://api.binance.com/api/v3/ticker/price?symbol=${symbol}`);
        const item = await res.json();
        
        if (item && item.price) {
            btn.textContent = `${icon}: ${parseFloat(item.price).toFixed(2)} $`;
        } else {
            btn.textContent = `${icon}: ${errorText}`;
        }

    } catch (e) {
        console.error("Failed to fetch TON price from Binance:", e);
        btn.textContent = `${icon}: ${errorText}`;
    }
}
setInterval(updateTonPriceInMainSection, 60000); 



async function fetchCryptoPrices(forceRefresh = false, toPopulateCalc = false) {
  const cryptoListDiv = document.getElementById('cryptoList');
  const lang = LANG_DATA[currentLang];
  
  const loadingText = lang.crypto.cryptoStatusLoading;
  const errorText = lang.crypto.cryptoStatusError;
  
  if (forceRefresh || !cryptoListDiv.innerHTML.includes('table')) {
     cryptoListDiv.innerHTML = `<p id="cryptoStatus">${loadingText}</p>`;
     const newStatusP = document.getElementById('cryptoStatus'); 
     if (!newStatusP) cryptoListDiv.querySelector('p').id = 'cryptoStatus';
  }

  const symbolsQuery = BINANCE_TOP_SYMBOLS.map(s => `"${s}"`).join(',');
  const url = `https://api.binance.com/api/v3/ticker/price?symbols=[${symbolsQuery}]`;
  
  try {
    const response = await fetch(url);
    if (!response.ok) {
        throw new Error(`HTTP error! status: ${response.status}`);
    }
    let data = await response.json(); 
    
    data = data.filter(item => item.price);
    
    data.forEach(item => {
        item.price = parseFloat(item.price);
    });
    
    cryptoPricesData = data.map(item => ({
        symbol: item.symbol,
        price: item.price
    }));

    if (toPopulateCalc) {
        populateCoinButtons(); 
        if (!selectedCoin && cryptoPricesData.length > 0) {
            selectCoin(cryptoPricesData[0]); 
        } else if (selectedCoin) {
            const updatedCoin = cryptoPricesData.find(c => c.symbol === selectedCoin.symbol);
            if(updatedCoin) {
                selectedCoin.price = updatedCoin.price;
                calculateCryptoValue();
            }
        }
    }

    let tableHTML = '<table dir="ltr"><thead><tr><th>' + lang.crypto.tableHeaders[0] + '</th><th>' + lang.crypto.tableHeaders[1] + '</th><th>' + lang.crypto.tableHeaders[2] + '</th></tr></thead><tbody>';

    data.forEach((item, index) => {
        const symbolBase = item.symbol.replace('USDT', '');
        const coinName = symbolToNameMap[item.symbol] || symbolBase;
        
        const price = item.price ? item.price.toLocaleString('en-US', { 
            style: 'currency', 
            currency: 'USD', 
            minimumFractionDigits: 2, 
            maximumFractionDigits: (item.price < 1 && item.price > 0.01) ? 4 : (item.price < 0.01) ? 6 : 2 
        }) : lang.other.cryptoNA;
        
        tableHTML += `
            <tr>
                <td>${index + 1}</td>
                <td class="name">${coinName} (${symbolBase})</td>
                <td class="price">${price}</td>
            </tr>
        `;
    });

    tableHTML += '</tbody></table>';
    cryptoListDiv.innerHTML = tableHTML;
    
  } catch (error) {
    console.error('Error fetching crypto prices from Binance:', error);
    cryptoListDiv.innerHTML = `<p id="cryptoStatus" style="color:red;">${errorText}</p>`;
  }
}


function createSnowflake() {
  const snow = document.createElement('div');
  snow.classList.add('snowflake');
  const size = Math.random() * 4 + 2;
  snow.style.width = `${size}px`;
  snow.style.height = `${size}px`;
  snow.style.left = `${Math.random() * window.innerWidth}px`;
  snow.style.animationDuration = `${Math.random() * 5 + 5}s`;
  snow.style.opacity = Math.random();
  document.body.appendChild(snow);
  setTimeout(() => snow.remove(), 10000);
}
setInterval(createSnowflake, 200);


document.addEventListener('click', function(event) {
  const sidebar = document.getElementById('sidebar');
  const menuBtn = document.querySelector('.menu-btn');
  const calcPopup = document.getElementById('crypto-calc-popup');
  const calcBtn = document.querySelector('.crypto-calc-btn-in-section');

  
  if(sidebar.style.left === "0px" && !sidebar.contains(event.target) && !menuBtn.contains(event.target)) {
    sidebar.style.left = "-240px";
  }
  
  if(calcPopup.style.display === "flex" && !calcPopup.contains(event.target) && (!calcBtn || !calcBtn.contains(event.target))) {
      if (!document.getElementById('coin-select-btn').contains(event.target) && !document.getElementById('coin-buttons-container').contains(event.target)) {
        closeCryptoCalcPopup();
      }
  }
});

// Calculator Logic
function updateDisplay() {
    const displayElement = document.getElementById('display');
    let content = displayValue;
    
    // Replace JS operators with display symbols 
    content = content.replace(/\*/g, '×').replace(/\//g, '÷');
    
    displayElement.textContent = content;
}

function handleInput(key) {
    playSound();
    const display = document.getElementById('display');
    const value = key.dataset.value;
    const action = key.dataset.action;

    // 
    const isOperator = (char) => ['+', '-', '*', '/'].includes(char);
    const isNumber = (char) => /[0-9]/.test(char);
    const isDecimal = (char) => char === '.';

    if (action === 'clear') {
        currentExpression = '';
        displayValue = '0';
        parenthesisCount = 0;
    } else if (action === 'calculate') {
        try {
            // 
            while (parenthesisCount > 0) {
                currentExpression += ')';
                parenthesisCount--;
            }
            // 
            let safeExpression = currentExpression.replace(/[^0-9\+\-\*\/\.\(\)\%]/g, '');
            
            // 
            safeExpression = safeExpression.replace(/(\d+(\.\d+)?)%/g, '($1/100)');
            
            // 
            safeExpression = safeExpression.replace(/[\+\-\*\/]$/, '');

            let result = eval(safeExpression);
            if (isNaN(result) || !isFinite(result)) {
                displayValue = 'Error';
            } else {
                displayValue = result.toString();
            }
            currentExpression = displayValue;
            parenthesisCount = 0;
            
        } catch (e) {
            displayValue = 'Error';
            currentExpression = '';
            parenthesisCount = 0;
        }
    } else if (action === 'sign') {
        // 
        if (currentExpression === '' || currentExpression === '0') {
            displayValue = '-0';
            currentExpression = '-';
        } else {
            // 
            if (currentExpression.startsWith('-')) {
                currentExpression = currentExpression.substring(1);
            } else {
                currentExpression = '-' + currentExpression;
            }
            displayValue = currentExpression;
        }

    } else if (action === 'parenthesis') {
        const lastChar = currentExpression.slice(-1);
        
        if (parenthesisCount > 0 && (isOperator(lastChar) || isNumber(lastChar) || isDecimal(lastChar) || lastChar === ')')) {
            // 
            currentExpression += ')';
            parenthesisCount--;
        } else if (isOperator(lastChar) || lastChar === '(' || currentExpression === '') {
            // 
            currentExpression += '(';
            parenthesisCount++;
        }
        displayValue = currentExpression;
    } else if (action === 'percent') {
        const lastChar = currentExpression.slice(-1);
        if (isNumber(lastChar) || lastChar === ')') {
            currentExpression += '%';
        }
        displayValue = currentExpression;
    } else if (action === 'decimal') {
        // 
        const lastOpIndex = Math.max(
            currentExpression.lastIndexOf('+'),
            currentExpression.lastIndexOf('-'),
            currentExpression.lastIndexOf('*'),
            currentExpression.lastIndexOf('/')
        );
        const lastNumber = currentExpression.substring(lastOpIndex + 1);

        // 
        if (!lastNumber.includes('.')) {
            if (isNumber(currentExpression.slice(-1)) || currentExpression === '') {
                currentExpression += '.'; // Use '.' in expression for eval
            } else if (isOperator(currentExpression.slice(-1)) || currentExpression.slice(-1) === '(') {
                 // 
                currentExpression += '0.'; // Use '0.' in expression for eval
            }
        }
        displayValue = currentExpression;

    } else if (key.classList.contains('number')) {
        if (displayValue === '0' || displayValue === 'Error' || displayValue === 'NaN' || (displayValue === '0' && currentExpression.length === 0)) {
            displayValue = value;
            currentExpression = value;
        } else {
            currentExpression += value;
            displayValue = currentExpression;
        }
    } else if (key.classList.contains('operator')) {
        const opMap = { 'add': '+', 'subtract': '-', 'multiply': '*', 'divide': '/' };
        const op = opMap[action];
        const lastChar = currentExpression.slice(-1);

        if (currentExpression === '' && op === '-') {
            // 
            currentExpression = '-';
        } else if (isOperator(lastChar)) {
            // 
            currentExpression = currentExpression.slice(0, -1) + op;
        } else if (currentExpression !== '' && lastChar !== '(' && lastChar !== '%') {
            currentExpression += op;
        }
        displayValue = currentExpression;
    }

    // 
    if (displayValue === '0' && currentExpression !== '0') {
        currentExpression = '';
    }

    updateDisplay();
}

// 
document.addEventListener('DOMContentLoaded', () => {
    const keys = document.querySelectorAll('.calc-key');
    keys.forEach(key => {
        key.addEventListener('click', () => handleInput(key));
    });
});


/**
 * * */
function loadUserPreferences() {
    const savedTheme = localStorage.getItem('theme');
    const savedLanguage = localStorage.getItem('language');
    const body = document.body;
    
    // 1. 
    if (savedTheme === 'dark') {
        body.classList.add('dark-mode');
        // 
        const btn = document.getElementById('darkModeBtn');
        if (btn) {
             // 
            btn.innerHTML = LANG_DATA['en'].sidebar.darkModeBtn[1]; 
        }
    } else {
        body.classList.remove('dark-mode');
    }

    // 2. 
    if (savedLanguage && LANG_DATA[savedLanguage]) {
        // 
        setLang(savedLanguage);
    } else {
        // 
        setLang('ar');
    }

    // 3. 
    updateTime(); 
    updateDate(); 
    updateTonPriceInMainSection(); 
    fetchCryptoPrices(true, true); 
    updateDisplay(); 
}

document.addEventListener('DOMContentLoaded', loadUserPreferences);
</script>
</body>
</html>
